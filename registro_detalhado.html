<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title data-i18n="titulo_registro_detalhado">Registro Detalhado ‚Äî Life Tech Pro</title>
<style>
  :root{
    --bg:#071416;
    --card:#00d398;
    --panel:#0b2b2a;
    --text:#a5a5a5;
    --muted:rgba(255,255,255,0.15);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:linear-gradient(180deg,#031616 0%,#072d34 100%);
    font-family:'Poppins',sans-serif;
    color:var(--text)
  }
  .wrap{max-width:1100px;margin:40px auto;padding:24px}
  header{display:flex;align-items:center;justify-content:space-between;padding-bottom:10px;border-bottom:1px solid rgba(255,255,255,0.1)}
  h1{margin:0;color:var(--card);letter-spacing:0.6px}
  a.back{color:var(--muted);text-decoration:none;font-weight:700}
  table{
    width:100%;border-collapse:collapse;margin-top:24px;
    background:rgba(255,255,255,0.03);border-radius:12px;overflow:hidden;
    box-shadow:0 10px 25px rgba(0,0,0,0.3)
  }
  th, td{padding:14px;text-align:left;font-size:0.95rem}
  th{background:rgba(255,255,255,0.08);color:var(--card);text-transform:uppercase;letter-spacing:0.5px}
  tr:nth-child(even){background:rgba(255,255,255,0.02)}
  tr:hover{background:rgba(255,255,255,0.05)}
  input, select{
    background:rgba(255,255,255,0.08);
    border:none;border-radius:6px;
    color:var(--text);
    padding:6px 8px;font-size:0.9rem;width:100%;
  }
  button{
    background:var(--card);border:none;padding:8px 12px;border-radius:10px;
    color:#042422;font-weight:700;cursor:pointer;transition:transform 0.2s;
  }
  button:hover{transform:scale(1.05);background:#00b682}
  .footer{margin-top:60px;text-align:center;color:rgba(255,255,255,0.35)}
  .total-box{
    margin-top:24px;
    background:rgba(255,255,255,0.05);
    padding:12px 18px;border-radius:12px;
    display:flex;justify-content:space-between;align-items:center;
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1 data-i18n="registro_detalhado">Registro Detalhado</h1>
      <a href="index.html" class="back" data-i18n="voltar_painel">‚Üê Voltar ao painel</a>
    </header>

    <div style="margin-top:20px;">
      <label data-i18n="cliente">Cliente:</label>
      <select id="clienteSelect" onchange="carregarEmprestimos()">
        <option value="" data-i18n="selecione_cliente">Selecione o cliente</option>
      </select>
    </div>

    <table id="tabelaDetalhes">
      <thead>
        <tr>
          <th data-i18n="data">Data</th>
          <th data-i18n="valor">Valor (R$)</th>
          <th data-i18n="juros">Juros (%)</th>
          <th data-i18n="vencimento">Vencimento</th>
          <th data-i18n="status">Status</th>
          <th data-i18n="acoes">A√ß√µes</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <button style="margin-top:18px;" onclick="adicionarLinha()" data-i18n="adicionar_emprestimo">+ Adicionar Empr√©stimo</button>

    <div class="total-box">
      <div data-i18n="total_com_juros">Total com Juros:</div>
      <div id="totalValor">R$ 0,00</div>
    </div>

    <div class="footer" data-i18n="rodape">¬© 2025 ‚Äî Life Tech Pro ¬∑ Design Futurista</div>
  </div>

  <script>
    const storageKey = 'emprestimos';
    let emprestimos = JSON.parse(localStorage.getItem(storageKey)) || [];

    const tabela = document.querySelector("#tabelaDetalhes tbody");
    const clienteSelect = document.getElementById("clienteSelect");
    const totalValor = document.getElementById("totalValor");

    function preencherClientes(){
      const nomes = [...new Set(emprestimos.map(e => e.nomeCliente))];
      const idioma = localStorage.getItem("idiomaAgroScan") || "pt";
      const textos = {
        pt: "Selecione o cliente",
        en: "Select client",
        es: "Seleccione el cliente"
      };
      clienteSelect.innerHTML = `<option value="">${textos[idioma]}</option>` +
        nomes.map(n => `<option value="${n}">${n}</option>`).join('');
    }

    function carregarEmprestimos(){
      tabela.innerHTML = "";
      const cliente = clienteSelect.value;
      if(!cliente) return;

      const lista = emprestimos.filter(e => e.nomeCliente === cliente);
      lista.forEach((emp, i) => criarLinha(emp, i));
      atualizarTotal();
    }

    function criarLinha(emp = {dataEmprestimo:"", valor:0, juros:0, vencimento:"", status:"Ativo"}, index = null){
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><input type="date" value="${emp.dataEmprestimo || ""}"></td>
        <td><input type="number" value="${emp.valor || 0}" step="0.01"></td>
        <td><input type="number" value="${emp.juros || 0}" step="0.01"></td>
        <td><input type="date" value="${emp.vencimento || ""}"></td>
        <td>
          <select>
            <option ${emp.status==="Ativo"?"selected":""} data-i18n="ativo">Ativo</option>
            <option ${emp.status==="Atrasado"?"selected":""} data-i18n="atrasado">Atrasado</option>
            <option ${emp.status==="Quitado"?"selected":""} data-i18n="quitado">Quitado</option>
          </select>
        </td>
        <td>
          <button onclick="salvar()">üíæ</button>
          <button onclick="removerLinha(this)">üóëÔ∏è</button>
        </td>
      `;
      tabela.appendChild(tr);
    }

    function adicionarLinha(){
      const idioma = localStorage.getItem("idiomaAgroScan") || "pt";
      const mensagens = {
        pt: "Selecione um cliente primeiro!",
        en: "Select a client first!",
        es: "¬°Seleccione un cliente primero!"
      };
      if(!clienteSelect.value){
        alert(mensagens[idioma]);
        return;
      }
      criarLinha();
    }

    function salvar(){
      const idioma = localStorage.getItem("idiomaAgroScan") || "pt";
      const mensagens = {
        pt: { selecione: "Selecione o cliente antes de salvar!", salvo: "üíæ Dados salvos com sucesso!" },
        en: { selecione: "Select the client before saving!", salvo: "üíæ Data saved successfully!" },
        es: { selecione: "¬°Seleccione el cliente antes de guardar!", salvo: "üíæ ¬°Datos guardados correctamente!" }
      };

      const cliente = clienteSelect.value;
      if(!cliente){ alert(mensagens[idioma].selecione); return; }

      emprestimos = emprestimos.filter(e => e.nomeCliente !== cliente);

      const linhas = tabela.querySelectorAll("tr");
      const novos = Array.from(linhas).map(linha => ({
        nomeCliente: cliente,
        dataEmprestimo: linha.cells[0].querySelector("input").value,
        valor: parseFloat(linha.cells[1].querySelector("input").value) || 0,
        juros: parseFloat(linha.cells[2].querySelector("input").value) || 0,
        vencimento: linha.cells[3].querySelector("input").value,
        status: linha.cells[4].querySelector("select").value
      }));

      emprestimos.push(...novos);
      localStorage.setItem(storageKey, JSON.stringify(emprestimos));
      atualizarTotal();
      alert(mensagens[idioma].salvo);
    }

    function removerLinha(btn){
      btn.closest("tr").remove();
      salvar();
    }

    function atualizarTotal(){
      const cliente = clienteSelect.value;
      if(!cliente){ totalValor.textContent = "R$ 0,00"; return; }

      const lista = emprestimos.filter(e => e.nomeCliente === cliente);
      const total = lista.reduce((acc, emp) => {
        const valorComJuros = emp.valor + (emp.valor * (emp.juros || 0) / 100);
        return acc + valorComJuros;
      }, 0);
      totalValor.textContent = "R$ " + total.toFixed(2);
    }

    window.addEventListener("load", () => {
      preencherClientes();
      carregarEmprestimos();
    });
  </script>

  <script src="assets/global-config.js"></script>
  <script src="assets/lang.js"></script>
  <script src="assets/script.js"></script>
</body>
</html>
